{{ extends "chatHHC_2r/MyPage.html" }}

{{ block title }}
{{ endblock }}

{{ block content }}
<!-- div displaying chat messages -->
<div class="container">
    <div class="left">
        <!-- <h2>Chat Instruction</h2><br> -->
        <span style="color:black; font-size: 15px;">
            We encourage you to <span style="color: red; font-weight:bold">share any difficulties you have encountered with the participant.</span><br><br>

            Feel free to engage in multiple rounds of conversation until you feel ready to conclude the interaction.<br><br>
            
            Now, let's get started!<br><br>

            <!-- Type <span style="color:red; font-weight: bold;">“Hello”</span> to start your discussion. -->
        </span>
    </div>
    
    <div class="right">
        <!-- div displaying chat messages -->
        <div class="textBox">
            <div id="chat_messages">
            </div>
        </div>

        <!-- text input -->
        <div class="inputBox">
            <div class="typeInputBox">
                <input type="text" id="chat_input" style="text-align:right;" autofocus>
                <button type="button" onclick="sendMsg()">Send</button>
            </div>
        </div>
        <br><br>

        <!-- oTree timer -->
        <p align="center">
            Page will auto-advance in:
            <span style="color:red; font-weight: bold">
                <span class="otree-timer__time-left"></span>
            </span>
            <br>
        <button class="btn btn-primary btn-large">
            Next Page
        </button>
        </p>
    </div>
</div>
{{ endblock }}

{{ block scripts }}
<script>

    let chat_input = document.getElementById('chat_input');

    chat_input.addEventListener("keydown", function (event) {
        if (event.key === "Enter") {
            sendMsg();
        }
    });

    function sendMsg() {
        let text = chat_input.value.trim();
        if (text) {
            liveSend({'text': text});
        }
        chat_input.value = '';
    }

    let chat_messages = document.getElementById('chat_messages');

    function liveRecv(messages) {
        for (let msg of messages) {
            let msgSpan = document.createElement('span');
            msgSpan.textContent = msg.text;
            let sender = msg.sender === js_vars.my_id ? `${js_vars.my_avatar}${js_vars.my_nickname}` : `${js_vars.alter_avatar}${js_vars.alter_nickname}`;
            let row = `<div><b>${sender}</b>: ${msgSpan.innerHTML}</div>`;
            chat_messages.insertAdjacentHTML('beforeend', row);
        }
    }

    document.addEventListener("DOMContentLoaded", function (event) {
        liveSend({});
    });

</script>
{{ endblock }}